<!DOCTYPE html>
<html>

<head>
    {% load static %}
    <!-- 引入图标样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/simple-line-icons@2.5.5/css/simple-line-icons.css" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="{% static 'css/components.chunk.css' %}">
    <link rel="stylesheet" href="{% static 'css/umi.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static 'js/echarts.min.js' %}"></script>
    <!-- 添加 FontAwesome 图标库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <!-- 引入 jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 引入 Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>

    <!-- 引入 Bootstrap 的 JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <meta name="theme-color" content="#343a40">

    <title>智慧医疗问答系统</title>
</head>

<body>
    <div id="root">
        <div id="page-container" class="null sidebar-o sidebar-dark page-header-dark side-scroll page-header-fixed main-content-boxed side-trans-enabled false">
            <div class="v2board-nav-mask" style="display: none;"></div>
            <nav id="sidebar">
                <div class="smini-hidden bg-header-dark">
                    <div class="content-header justify-content-lg-center bg-white-10"><a class="font-size-lg text-white" href="/medical/homepage/"><span class="text-white-75">智慧医疗问答系统</span></a>
                        <div class="d-lg-none"><a class="text-white ml-2" data-toggle="layout" data-action="sidebar_close" href="javascript:void(0);"><i class="fa fa-times-circle"></i></a></div>
                    </div>
                </div>
                <div class="content-side content-side-full">
                    <ul class="nav-main">
                        <li class="nav-main-heading">欢迎光临</li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/homepage/"><i class="nav-main-link-icon si si-book-open"></i><span class="nav-main-link-name">主页</span></a></li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/instruction/"><i class="nav-main-link-icon si si-book-open"></i><span class="nav-main-link-name">使用说明</span></a></li>
                        <li class="nav-main-heading">功能</li>
                        <li class="nav-main-item"><a class="nav-main-link flase" href="/medical/guess/"><i class="nav-main-link-icon si si-question"></i><span class="nav-main-link-name">猜你所想</span></a></li>
                        <li class="nav-main-item"><a class="nav-main-link active"><i class="nav-main-link-icon si si-question"></i><span class="nav-main-link-name">病痛显微镜</span></a></li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/inquiry/"><i class="nav-main-link-icon si si-question"></i><span class="nav-main-link-name">龙灵问疾</span></a></li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/inquiryplus/"><i class="nav-main-link-icon si si-question"></i><span class="nav-main-link-name">龙灵问疾（Plus Beta）</span></a></li>
                        <li class="nav-main-heading">用户</li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/user/"><i class="nav-main-link-icon si si-users"></i><span class="nav-main-link-name">用户中心</span></a></li>
                        <li class="nav-main-heading">关于</li>
                        <li class="nav-main-item"><a class="nav-main-link false" href="/medical/illustration/"><i class="nav-main-link-icon si si-book-open"></i><span class="nav-main-link-name">说明</span></a></li>

                    </ul>
                </div>
                <div class="v2board-copyright">智慧医疗问答系统 v1.0.0</div>
            </nav>
            <header id="page-header">
                <div class="content-header">
                    <div class="sidebar-toggle" style="display: none;"><button type="button" class="btn btn-primary mr-1 d-lg-none"><i class="fa fa-fw fa-bars"></i></button></div>
                    <div class="v2board-container-title text-white">病痛显微镜</div>
                    <div>
                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn btn-primary dropdown-button">
                                <i class="far fa fa-user-circle"></i>
                                <span class="d-none d-lg-inline ml-1">{{ user_info.username }}</span>
                                <i class="fa fa-fw fa-angle-down ml-1"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right p-0 false">
                                <div class="p-2">
                                    <a class="dropdown-item" href="/medical/user/">
                                        <i class="far fa-fw fa-user mr-1"></i> 用户中心
                                    </a>
                                    <a class="dropdown-item" href="/medical/login/">
                                        <i class="far fa-fw fa-arrow-alt-circle-left mr-1"></i> 登出
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <main id="main-container">
                <div class="content content-full">
                    <div class="row mb-3 mb-md-0">
                        <div class="col-xl-12">
                            <div class="block block-rounded js-appear-enabled">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">{{ name }}</h3>
                                </div>
                                <div class="block-content py-3">
                                    <p>{{ summary }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 两栏布局 -->
                    <div class="row mb-3 mb-md-0">
                        <!-- 第一栏 -->
                        <div class="col-md-6 mb-4">
                            <div class="block block-rounded js-appear-enabled" style="overflow: hidden;">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">成因</h3>
                                </div>
                                <div class="block-content py-3">
                                    <div class="collapse" id="collapseCause">
                                        <p>{{ cause }}</p>
                                    </div>
                                    <a class="btn btn-sm btn-primary" data-toggle="collapse" href="#collapseCause" aria-expanded="false" aria-controls="collapseCause">展开</a>
                                </div>
                            </div>

                            <div class="block block-rounded js-appear-enabled" style="overflow: hidden;">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">预防措施</h3>
                                </div>
                                <div class="block-content py-3">
                                    <div class="collapse" id="collapsePrevent">
                                        <p>{{ prevent }}</p>
                                    </div>
                                    <a class="btn btn-sm btn-primary" data-toggle="collapse" href="#collapsePrevent" aria-expanded="false" aria-controls="collapsePrevent">展开</a>
                                </div>
                            </div>

                            <div class="block block-rounded js-appear-enabled" style="overflow: hidden;">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">详细信息</h3>
                                </div>
                                <div class="block-content py-3">
                                    <div class="collapse" id="collapsetext">
                                        <p>{{ text }}</p>
                                    </div>
                                    <a class="btn btn-sm btn-primary" data-toggle="collapse" href="#collapsetext" aria-expanded="false" aria-controls="collapsetext">展开</a>
                                </div>
                            </div>
                        </div>

                        <!-- 第二栏 -->
                        <div class="col-md-6 mb-4">
                            <div class="block block-rounded js-appear-enabled" style="overflow: hidden;">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">关系图谱</h3>
                                </div>
                                <div id="main" style="width: 100%; height: 500%;"></div>
                            </div>
                        </div>

                        <!-- 折叠 js 实现组件 -->
                        <script>
                            $(document).ready(function() {
                                // 监听展开和折叠事件
                                $('.collapse').on('show.bs.collapse', function() {
                                    // 在展开时更新按钮文本
                                    $(this).parent().find('[data-toggle="collapse"]').text('收起');
                                }).on('hide.bs.collapse', function() {
                                    // 在折叠时更新按钮文本
                                    $(this).parent().find('[data-toggle="collapse"]').text('展开');
                                });
                            });
                        </script>

                        <!-- 保证在浏览器窗口大小变化时刷新 ECharts 图表 -->
                        <script>
                            // 获取 ECharts 实例
                            var chart = echarts.init(document.getElementById('main'));

                            window.addEventListener('resize', function() {
                                chart.resize();
                            });
                        </script>

                        <script>
                            var neo4j_data = JSON.parse('{{ neo4j_data|escapejs }}');
                            var data = neo4j_data['data']
                            console.log("data:", data);
                            var links = neo4j_data['links']
                            console.log("links:", links)

                            var myChart = echarts.init(document.getElementById('main'));
                            var categories = [{
                                name: "检查"
                            }, {
                                name: "治疗方式"
                            }, {
                                name: "疾病"
                            }, {
                                name: "症状"
                            }, {
                                name: "科室"
                            }, {
                                name: "药物"
                            }, {
                                name: "食物"
                            }];

                            var option;

                            // 如果 ECharts 还在加载，则显示加载动画
                            myChart.showLoading();

                            setTimeout(function() {
                                // 等待数据加载
                                myChart.hideLoading();

                                option = {
                                    legend: [{
                                        // selectedMode: 'single',
                                        data: categories.map(function(a) {
                                            return a.name;
                                        })
                                    }],
                                    series: [{
                                        type: 'graph', // 类型:关系图
                                        layout: 'force', // 图的布局，类型为力导图
                                        symbolSize: 50, // 调整节点的大小

                                        edgeSymbol: ['circle', 'arrow'],
                                        edgeSymbolSize: [2, 10],
                                        edgeLabel: {
                                            normal: {
                                                textStyle: {
                                                    fontSize: 20
                                                }
                                            }
                                        },
                                        force: {
                                            edgeLength: [100, 200],
                                            repulsion: 200,
                                            gravity: 0.2,
                                            // initLayout: 'circular'
                                        },
                                        draggable: true,
                                        lineStyle: {
                                            normal: {
                                                width: 1,
                                                color: '#000000',
                                            }
                                        },
                                        label: {
                                            normal: {
                                                show: true,
                                                textStyle: {}
                                            },
                                        },
                                        edgeLabel: {
                                            normal: {
                                                show: true,
                                                textStyle: {
                                                    fontSize: 10
                                                },
                                                // 获取边的信息
                                                formatter: (params) => {
                                                    return params.data['name']
                                                }
                                            }
                                        },
                                        // 数据
                                        data: data,
                                        links: links,
                                        categories: categories,
                                        color: ['#E74C3C', '#3498DB', '#F1C40F', '#27AE60', '#fb8b05', '#bacf65', '#9B59B6'],
                                        autoCurveness: 0.01, // 多条边的时候，自动计算曲率
                                    }]
                                };

                                console.log(option);
                                if (option && typeof option == 'object') {
                                    myChart.setOption(option);
                                }
                            }); // 等待数据加载完成
                        </script>
                    </div>
            </main>
            </div>
        </div>
</body>

</html>